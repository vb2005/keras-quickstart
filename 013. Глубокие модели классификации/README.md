# Работа №13
### Глубокие модели классификации

В данной работе предлагается ознакомиться с существующими моделями ImageNet, которые доступны в наборе Keras.Applications

### Сведения о работе

Необходимые библиотеки: `keras`

Время на выполнение: ![](https://img.shields.io/badge/90-минут-blue)

### Введение
Обработка изображений - сложная задача, которая требует значительных ресу
Для задач машинного обучения важной составляющей является визуализация как исходных данных, так и метрик, полученных в процессе обучения модели. Графики позволяют наглядно оценить показатели, а также предоставить заказчику подробные и красивые отчёты по процессу подготовки моделей.

## Импорт библиотек

В данной работе мы рассмотрим уже предобученные модели, а также попробуем обучить готовые модели на своих данных.

В начале, подключите необходимые зависимости в проект:

``` python 
import cv2
import keras
import numpy as np
import pandas as pd
import tensorflow as tf
```
## Загрузка существующей классификационной сети

В составе Keras.Applications содержатся около 40 моделей, обученных на наборе ImageNet. 
Ознакомится с существующими моделями можно по ссылке: https://keras.io/api/applications/

Рассмотрим, как получить уже обученную модель и присоединить к проекту. Это можно сделать всего одной командой. 

``` python
model = keras.applications.VGG19(
    include_top=True,
    weights="imagenet",
    input_tensor=None,
    input_shape=None,
    pooling=None,
    classes=1000,
    classifier_activation="softmax",
)
```

## Получение списка классов

Набор ImageNet содержит описание 1000 классов. Чтобы понять, к какому классу принадлежит объект, давайте загрузим его в наш проект по ссылке: https://raw.githubusercontent.com/xmartlabs/caffeflow/master/examples/imagenet/imagenet-classes.txt

``` python
# Посмотрим, что в этом файле содержится
d = pd.read_csv('imagenet-classes.txt', delimiter='$', )
# Эта функция выведет аннотацию к указанному индексу
d.loc[985]
```

## Получение предсказания с использованием готовой модели

``` python
# Загружаем файл на облако
uploaded = files.upload()

# Больше не печатать в экспоненциальном виде
np.set_printoptions(suppress=True)

# для каждого загруженного файла прочитать изображение, и получить выходы с нейронов
for fn in uploaded.keys():
  test = cv2.resize(cv2.imread(fn, cv2.IMREAD_COLOR), (224, 224))
  test = tf.expand_dims(test, axis=0)
  # Данная функция строит вероятности для кажого из классов
  result = model.predict(test)
  # Данная функция находит индекс самой большой вероятности
  index = np.argmax(result[0])
  # А теперь самостоятельно доработайте функцию, чтобы она писала, какой объект она нашла
  print(index)
  print(d.loc[index])
```

## Самостоятельная работа
**Задача 1.** Самостоятельно разберитесь с тем, как обучить готовую модель на собственном наборе данных. За основу можно взять Cats-vs-Dogs из работы 12.

**Задача 2.** Исследуйте точность и скорость работы на 5 различных моделях из Keras Applications. Оформите результаты в виде таблицы.

## Контрольные вопросы
1. Какие глубокие модели для классификации изображений Вы знаете?
2. Что представляет из себя датасет ImageNet?
3. Как изменить размер входного тензора у готовой модели?
