# Экспертная система определения сердечно-сосудистых заболеваний на основе ЭКГ
*На базе открытого набора данных: https://archive.ics.uci.edu/ml/datasets/Arrhythmia*

Ссылка на dataset:
[https://drive.google.com/file/d/1AUWVAerSdYgqKrsWJQH-YK4d3JWnZ5oc/view?usp=sharing](https://github.com/vb2005/keras-quickstart/blob/main/Datasets/Arrhythmia.csv)

## Блок 1. Подключение библиотек
Для работы потребуются: Библиотеки для работы с данными (Pandas, Numpy). Пакет keras для построения нейронных сетей и matplotlib для построения графиков
``` python
import numpy as np
import pandas as pd
from keras import Sequential
from keras.layers import Activation, Dense
from matplotlib import pyplot as plt
```
## Блок 2. Загрузка данных
Читаем данные из CSV и делаем из них массив Numpy. Попробуем сделать это через Pandas
``` python
df = pd.read_csv('Arrhythmia.csv', sep=";",header=None)
data = df.to_numpy()
```

## Блок 3. Разделение сырых данных на выборки
Последний столбец - диагноз. 1 - если здоров, 2..18 - коды заболеваний. Нейронная сеть будет лишь выявлять: здоров пациент или нет. Поэтому 1 меняем на 0, а всё остальное на 1.

``` python
for i in range(452):
  if data[i,276] <= 1:
    data[i,276] = 0
  else:
    data[i,276] = 1
```

Далее разделяем входные и выходные данные
``` python
X = data[:,:276]
Y = data[:,276]
```

``` python
# Можем вывести массив:
X
```

## Блок 4. Модель нейронной сети
Поле для творчества. Слои и функции активации на Ваш выбор. Каждая новая строка - новый скрытый слой внутри сети. В качестве аргумента указывается активационная функция для всех нейронов данного слоя и их количество. Попробуйте самостоятельно описать архитектуру, которая даст лучшие показатели, чем эта архитектура. Сравните результаты в группе
``` python
model = Sequential()

# Первый слой - 274 нейрона (по размеру входного вектора). Далее данные приводятся при помощи функции активации Sigmoid
model.add(Dense(274,"sigmoid"))

# Второй слой и последующие задают глубину обучения и количество весовых коэффициентов.
# Далеко не всегда разумно бесконечно наращивать глубину сети. Иногда сеть и из 2х слоёв
# Справляется с указанной задачей
model.add(Dense(200,"exponential"))
model.add(Dense(200,"sigmoid"))

# Выходной слой с 1 значением. У нас это индикатор наличия или отсутствия заболевания
model.add(Dense(1,"sigmoid"))
```

## Блок 5. Сборка сети и старт обучения
Выбираем оптимизатор и функцию потерь и запускаем обучение. Для того, чтобы оценить точность работы на разных архитектурах используем во всех экспериментах равное число эпох и одинаковые функции потерь и активации
``` python

model.compile("Adam","MSE")            # Сборка графа. Указание оптимизатора и функции потерь
history = model.fit(                   # Результат обучения сохраняется в переменную history
    X,Y,                               # Обучающая выборка
    batch_size=32,                     # Размер посылки
    epochs=50,                         # Число эпох. Используем 50.
    validation_split=0.2)              # Выборка для валидации
```

## Блок 6. Визуализация результатов
``` python
# Визуализация графика
plt.plot(history.history['loss'])
plt.plot(history.history['val_loss'])
plt.title('Функция потерь')
plt.ylabel('Потери (меньше - лучше)')
plt.xlabel('Число эпох')
plt.legend(['Обучающая', 'Тестовая'], loc='upper left')
plt.show()
```

## Блок 7. Оценка потерь вручную
``` python
# Ручной просчёт точности работы нейронной сети:

# Получаем предсказанные на основании нейронной сети значения
pred_Y = model.predict(X).ravel()

# Вычисляем сумму модулей поэлементной разницы двух массивов и делим на количество примеров
difference = pow((pred_Y - Y),2).sum() / len(pred_Y)

# Получаем итоговую точность работы на указанных примерах. Больше - лучше
print('Точнось работы:', (100-difference*100), '%')
```

## Задания на самостоятельную работу
**Оценка отмены брони в отеле**
В данной работе предлагается проанализировать набор данных из открытой библиотеки Kaggle, посвященный анализу критериев, которые чаще всего влияют на отмену брони в отеле.

Ссылка на набор данных: https://www.kaggle.com/datasets/ahsan81/hotel-reservations-classification-dataset

Ссылка на локальный набор: https://github.com/vb2005/keras-quickstart/blob/main/Datasets/hotels.csv

Всего 17 критериев (кол-во номеров, тип брони, способ оплаты и т.д.) и итоговый результат: заселение или отмена. Требуется выполнить предобработку данных (удалить ID, строковые классы заменить на числовые, провести фильтрацию строк, если это необходимо). Всего в выборке более 65.000 броней и их статусы

## Контрольные вопросы
1. Что такое нейрон?
2. Что такое нейронная сеть?
3. Функции активации. Виды и графики
4. Выборки данных: обучающая, валидационная, тестовая
5. Настройка модели: функция потерь, количество эпох, алгоритм обучения (оптимизатор)
6. Анализ результатов обучения. Что описывает метрика loss, val_loss?
7. Что такое недообучение и переобучение? Продемонстрируйте эти состояния на графике функции потерь
