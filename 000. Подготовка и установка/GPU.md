# Установка Tensorflow/Keras на Windows с поддержкой GPU

С версии 2.13 установка TensorFlow GPU на Windows невозможна. 
Теперь запуск нейронок возможен только через дистрибутивы Linux. 
В свою очередь Microsoft предоставляет возможности для запуска Linux-программ через подсистему WSL2. 

## Минимальные системные требования
Чтобы использовать ее для установки TensorFlow, проверьте, что ПК удовлетворяет системным требованиям:
1. Процессор и материнская плата поддерживают виртуализацию (VT-d или AMD-v), а сама виртуализация включена в UEFI
2. ОС Windows 10 версии 1903 (18362) и новее
3. Не менее 8 Гб RAM
4. Не менее 8 Гб места на системном диске
5. Наличие GPU с поддержкой технологии CUDA
 
## 0. Подготовка ПК

Включите поддержку виртуализации в BIOS, если она отключена. (Настройки могут называться также SVM или VMX). 
Проверить ее доступность можно в диспетчере задач, в разделе "Процессор". Если все настроено корректно, то значение параметра "Виртуализация" будет "Включено"

## 1. Установка CUDA Toolkit

Загрузите пакет NVIDIA CUDA Toolkit по ссылке: https://developer.nvidia.com/cuda-toolkit.
Пакет уже содержит драйвер видеокарты, поэтому даже если в ОС еще не были установлены драйверы, можно ставить сразу данный пакет.
При установке выбирайте все опции.

## 2. Активация дополнений WSL

Подключите компоненты ОС, отвечающие за WSL и виртуализацию. После включения необходимо **ОБЯЗАТЕЛЬНО** перезагрузить ПК.

``` 
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
 
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

## 3. Установка поддержки WSL2
Загрузите и установите обновление для WSL по ссылке: https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi
Перезагрузите компьютер

Активируйте режим работы WSL2:

```
wsl --set-default-version 2
```

## 4. Установка Ubuntu 24.02 LTS

Откройте магазин приложений Windows Store и скачайте из него приложение Ubuntu 24.04 LTS
или откройте ссылку https://apps.microsoft.com/detail/9NZ3KLHXDJP5?hl=neutral&gl=RU&ocid=pdpshare

## 5. Настройка Ubuntu

В меню Пуск найдите ссылку на консоль Ubuntu 24.04 LTS, откройте её. В первый запуск WSL2 предложит установить пароль суперпользователя. Запомните этот пароль и не делайте его слишком сложным. Вводить его придётся часто

Проверьте доступность видеокарты в подсистеме WSL2 при помощи команды 

```
nvidia-smi
```

Теперь необходимо установить CUDA Toolkit уже для платформы Linux. Для этого скачайте пакет и установите его следующими командами:

```
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2404/x86_64/cuda-keyring_1.1-1_all.deb
sudo dpkg -i cuda-keyring_1.1-1_all.deb
```

Далее установите дополнение CuDNN. Именно оно используется для ускорения обучения нейронных сетей
```
sudo apt-get update
sudo apt-get -y install cudnn
```

## 6. Настройка окружения Python

Установите утилиты pip, venv, requests, если они ранее не были установлены

```
sudo apt install python3-pip
sudo apt install python3-requests
sudo apt install python3-venv
```

Поскольку tensorflow требует для себя отдельное виртуальное окружение, то установите его и активируйте для работы

```
python3 -m venv .venv
source .venv/bin/activate
```

Теперь для виртуального окружения установим необходимые компоненты:
 
```
pip install requests
python3 -m pip install tensorflow[and-cuda]
pip install jupyterlab
pip install opencv-python
```

Я предлагаю использовать jupyterlab для удобного веб-интерфейса. Можно писать программы в любом другом редакторе кода и запускать через консоль, либо же использовать любую другую альтернативу jupyterlab.

## 7. Запуск платформы

Для запуска платформы активируйте окружение (если оно ранее не было активировано) и запустите jupyter lab

```
source .venv/bin/activate
jupyter lab
```

После запуска в консоле будет написан адрес доступа с токеном. Токен нужен для доступа без авторизации, ссылка на этот файл будет выглядететь похожим образом:
```
http://localhost:8888/lab?token=afb8c40c8f5a27d190085d8882f3d2fe2ad2dcdbf4458e5b
```
